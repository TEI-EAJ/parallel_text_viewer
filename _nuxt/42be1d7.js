(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{455:function(t,e){},456:function(t,e){},498:function(t,e,n){var content=n(624);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(76).default)("1b7833da",content,!0,{sourceMap:!1})},531:function(t,e){},533:function(t,e){},567:function(t,e){},569:function(t,e){},570:function(t,e){},575:function(t,e){},577:function(t,e){},583:function(t,e){},585:function(t,e){},604:function(t,e){},616:function(t,e){},619:function(t,e){},623:function(t,e,n){"use strict";n(498)},624:function(t,e,n){var r=n(75)(!1);r.push([t.i,".scroll{height:100%;overflow-y:auto}.vertical{-ms-writing-mode:tb-rl;writing-mode:vertical-rl}#app,body,html{height:100%;margin:0}",""]),t.exports=r},691:function(t,e,n){"use strict";n.r(e);n(14),n(179),n(54),n(249),n(22),n(33),n(26),n(140),n(36),n(46),n(52);var r=n(440),l=n(110),o=n.n(l),c=(n(441),n(526)),d=n(516).scroller;function v(t){return c.createHash("md5").update(t,"binary").digest("hex")}var h={components:{Splitpanes:r.b,Pane:r.a},data:function(){return{width:window.innerWidth,height:window.innerHeight,barHeight:0,returnUrl:null,returnLabel:null,dialogInformation:!1,dialogSettings:!1,urlMain:"",urlSub:"",test:"",dataMain:[],dataSub:[],dataMainE:[],dataSubE:[],hightlights:[],mSIdMap:[],sMIdMap:[],wLIdMap:{},lWIdMap:{},imageMap:{},labelMain:"",labelSub:"",selectedManifests:[],miradorPath:"",direction:"vertical",layout:"2x2"}},watch:{$route:function(){this.search()}},mounted:function(){var t=this,e=document.getElementById("bar");e&&(this.barHeight=e.clientHeight);var n=document.getElementById("main");n.addEventListener("wheel",(function(t){n.scrollLeft-=t.deltaY}));var r=document.getElementById("sub");r.addEventListener("wheel",(function(t){r.scrollLeft-=t.deltaY})),window.addEventListener("resize",this.handleResize),null===this.$route.query.u&&"localhost"!==location.hostname&&(location.href="https://github.com/TEI-EAJ/parallelText_viewer/");var u=this.$route.query.u;o.a.get(u).then((function(e){var n=e.data;t.returnUrl=n.return_url,t.returnLabel=n.return_label,t.urlMain=n.url_main,t.labelMain=n.label_main,t.labelSub=n.label_sub;var r=n.query_main,l=n.query_sub;t.direction=n.direction,n.layout&&(t.layout=n.layout);var c=n.image_map;o.a.get(c).then((function(e){for(var o=[],c=[],d={},v=e.data.selections,i=0;i<v.length;i++){var h=v[i],f=h.within,m=f.label,_=f["@id"];d[m]={manifest:_,data:{}},o.push({manifest:_}),t.selectedManifests.push({label:m,selected:!0});for(var M=h.members,w=0;w<M.length;w++){var y=M[w];if(y.lineId){var I=y.lineId;c[I=t.convertUri(I)]||c.push(I),d[m].data[I]=y["@id"]}}}t.imageMap=d,t.miradorPath="mirador/?params="+encodeURIComponent(JSON.stringify(o))+"&annotationState=on&layout="+t.layout,t.exec2map(n.url_map),t.exec2main(n.url_main,c,r),t.exec2sub(n.url_sub,l)}))}))},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)},methods:{clickIcon:function(t){for(var e=this.selectedManifests,n=[],i=0;i<e.length;i++){var r=e[i];if(r.selected){var l=r.label,o=this.imageMap[l].data;if(o[t]){var c=o[t],d=c.split("#xywh="),canvas=d[0],v=d[1].split(","),h=Number(v[1])-150,f=Number(v[3])+150;c=canvas+"#xywh="+v[0]+","+h+","+v[2]+","+f,n.push({manifest:this.imageMap[l].manifest,canvas:c})}this.miradorPath="mirador/?params="+encodeURIComponent(JSON.stringify(n))+"&annotationState=on&layout="+this.layout}}},scroll:function(t){var e=[],n="";if(this.mSIdMap[this.wLIdMap[t]]?(e=this.mSIdMap[this.wLIdMap[t]],n="sub"):this.lWIdMap[this.sMIdMap[t][0]]&&(e=this.lWIdMap[this.sMIdMap[t][0]],n="main"),e.length>0){var r=null,l=e[0];if("vertical"===this.direction){var o=document.querySelector("#"+n),c=document.querySelector("#"+l);r={container:"#"+n,offset:-1*o.getBoundingClientRect().width+(c?c.getBoundingClientRect().width:0),x:!0}}else r={container:"#"+n,y:!0};d()("#"+l,500,r)}},mouseoverMain:function(data){if(data.target.attributes.length>0&&"id"===data.target.attributes[0].name){var t=data.target.attributes[0].value,e=this.wLIdMap[t],n=[];if(this.mSIdMap[e]){var r=this.mSIdMap[e];n=r;for(var i=0;i<r.length;i++)for(var l=r[i],o=this.sMIdMap[l],c=0;c<o.length;c++){var d=o[c],v=this.lWIdMap[d];n=n.concat(v)}}this.hightlights=n}},mouseover:function(data){if(0!==Object.keys(this.wLIdMap)&&data.target.attributes.length>0&&"id"===data.target.attributes[0].name){var t=data.target.attributes[0].value,e=[t];if(this.sMIdMap[t])for(var n=this.sMIdMap[t],r=0;r<n.length;r++){var l=n[r],o=this.lWIdMap[l];e=e.concat(o)}this.hightlights=e}},handleResize:function(){this.width=window.innerWidth,this.height=window.innerHeight},exec2map:function(t){var e=this;o.a.get(t).then((function(t){var n=t.data;for(var r in n){for(var l=n[r],o=[],i=0;i<l.length;i++){var c=l[i],d=e.convertUri(c);o.push(d)}n[r]=o}var v={};for(var h in n)for(var f=n[h],m=0;m<f.length;m++){var _=f[m];v[_]||(v[_]=[]),v[_].push(h)}e.mSIdMap=v,e.sMIdMap=n;var M={},w={};for(var y in v){var I=y.split("#"),x=I[0],S=I[1].split(":"),k=Number(S[0]),C=Number(S[1]);w[y]=[];for(var E=k;E<C;E++){var V=x+"-"+E;M[V]=y,w[y].push(V)}}e.wLIdMap=M,e.lWIdMap=w}))},exec2main:function(t,e,n){var r=this;o.a.get(t,{responseType:"document"}).then((function(t){for(var l=t.data.querySelectorAll(n),o=[],i=0;i<l.length;i++){var line=l[i],c=line.attributes[0].value;c=r.convertUri(c);for(var d=line.childNodes,v="",h=[],f=0;f<d.length;f++){var m=d[f];v+=(m.innerText||m.textContent).trim()}for(var _=0;_<v.length;_++){var M=v.slice(_,_+1);h.push({value:M,id:c+"-"+_})}var w={id:c,words:h};(e.includes(c)||line.attributes[0].value.includes("-01"))&&(w.manifest=!0),o.push(w),r.dataMainE=o}}))},exec2sub:function(t,e){var n=this;o.a.get(t,{responseType:"document"}).then((function(t){for(var r=t.data.querySelectorAll(e),l=[],i=0;i<r.length;i++){for(var line=r[i],o=line.attributes[0].value,c=line.childNodes,d="",v=0;v<c.length;v++){var h=c[v];d+=(h.innerText||h.textContent).trim()}var f={id:o,value:d};l.push(f)}n.dataSub=l}))},convertUri:function(t){var e=t.split("#");return 2!==e.length?"id-"+v(t):"id-"+v(e[0])+"#"+e[1]}}},f=(n(623),n(66)),m=n(178),_=n.n(m),M=n(362),w=n(696),y=n(506),I=n(373),x=n(690),S=n(508),k=n(697),C=n(685),E=n(695),V=n(693),L=n(513),T=n(384),component=Object(f.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-main",[n("v-toolbar",{attrs:{id:"bar",dark:!0,flat:""}},[n("v-toolbar-title",[t._v("Parallel Text Viewer with TEI & IIIF")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialogSettings=!0}}},[n("v-icon",[t._v("mdi-settings")])],1),t._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialogInformation=!0}}},[n("v-icon",[t._v("mdi-information")])],1),t._v(" "),n("v-toolbar-items",{directives:[{name:"show",rawName:"v-show",value:t.returnUrl,expression:"returnUrl"}]},[n("v-btn",{attrs:{text:"",href:t.returnUrl}},[t._v(t._s(t.returnLabel))])],1)],1),t._v(" "),n("div",{style:"height: "+(t.height-t.barHeight)+"px"},[n("splitpanes",{staticClass:"default-theme"},[n("pane",{attrs:{"min-size":"20"}},[n("iframe",{staticStyle:{border:"none"},attrs:{src:t.miradorPath,seamless:"seamless",width:"100%",height:t.height-t.barHeight+"px",allow:"fullscreen"}})]),t._v(" "),n("pane",[n("splitpanes",{staticClass:"default-theme",attrs:{horizontal:"horizontal"}},[n("pane",{},[n("v-card",{staticClass:"scroll vertical",attrs:{id:"main",flat:!0}},[n("div",{staticClass:"pa-2"},[n("h2",{staticClass:"text--primary"},[t._v(t._s(t.labelMain))]),t._v(" "),n("br"),t._v(" "),t._l(t.dataMainE,(function(e,r){return n("p",{key:r},[e.manifest?n("span",[n("img",{staticClass:"mr-2",staticStyle:{width:"30px"},attrs:{src:"https://iiif.dl.itc.u-tokyo.ac.jp/images/iiif.png"},on:{click:function(n){return t.clickIcon(e.id)}}}),t._v(" "),n("br")]):t._e(),t._v(" "),t._l(e.words,(function(e,r){return n("span",{key:r,style:-1!==t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseoverMain,click:function(n){return t.scroll(e.id)}}},[t._v(t._s(e.value))])}))],2)}))],2)])],1),t._v(" "),n("pane",[n("v-card",{staticClass:"scroll vertical",attrs:{id:"sub",flat:!0}},[n("div",{staticClass:"pa-2"},[n("h2",{staticClass:"text--primary"},[t._v(t._s(t.labelSub))]),t._v(" "),n("br"),t._v(" "),t._l(t.dataSub,(function(e,r){return n("div",{key:r},[n("span",{style:-1!==t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseover,click:function(n){return t.scroll(e.id)}}},[t._v(t._s(e.value))])])}))],2)])],1)],1)],1)],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{width:"600px"},model:{value:t.dialogInformation,callback:function(e){t.dialogInformation=e},expression:"dialogInformation"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Information")]),t._v(" "),n("v-card-text",{staticClass:"mt-5"},[n("a",{attrs:{target:"_blank",href:t.$route.query.u}},[t._v(t._s(t.$route.query.u))])]),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialogInformation=!1}}},[t._v("閉じる")])],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{width:"600px"},model:{value:t.dialogSettings,callback:function(e){t.dialogSettings=e},expression:"dialogSettings"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Settings")]),t._v(" "),n("v-card-text",{staticClass:"mt-5"},[n("v-text-field",{staticClass:"mb-5",attrs:{label:"Mirador表示レイアウト Ex. 1x1, 2x2, ..."},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}}),t._v(" "),t._l(t.selectedManifests,(function(e,r){return n("v-switch",{key:r,attrs:{label:e.label},model:{value:e.selected,callback:function(n){t.$set(e,"selected",n)},expression:"obj.selected"}})}))],2),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialogSettings=!1}}},[t._v("閉じる")])],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;_()(component,{VApp:M.a,VBtn:w.a,VCard:y.a,VCardActions:I.a,VCardText:I.b,VCardTitle:I.c,VDialog:x.a,VIcon:S.a,VMain:k.a,VSpacer:C.a,VSwitch:E.a,VTextField:V.a,VToolbar:L.a,VToolbarItems:T.a,VToolbarTitle:T.b})}}]);