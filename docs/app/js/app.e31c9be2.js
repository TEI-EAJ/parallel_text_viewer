(function(t){function e(e){for(var n,s,l=e[0],o=e[1],c=e[2],d=0,m=[];d<l.length;d++)s=l[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&m.push(i[s][0]),i[s]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n]);u&&u(e);while(m.length)m.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,l=1;l<a.length;l++){var o=a[l];0!==i[o]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=o;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},"4b67":function(t,e,a){},5:function(t,e){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("router-view",{on:{"change-locale":t.changeLocale}})},r=[],s={methods:{changeLocale:function(){this.$i18n.locale="ja"===this.$i18n.locale?"en":"ja"}}},l=s,o=a("2877"),c=Object(o["a"])(l,i,r,!1,null,null,null),u=c.exports,d=a("8c4f"),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-content",[a("v-toolbar",{attrs:{dark:!0,flat:""}},[a("v-toolbar-title",[t._v("Parallel Text Viewer with TEI & IIIF")]),a("v-spacer"),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_settings=!0}}},[a("v-icon",[t._v("mdi-settings")])],1),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_information=!0}}},[a("v-icon",[t._v("mdi-information")])],1),a("v-toolbar-items",{directives:[{name:"show",rawName:"v-show",value:t.return_url,expression:"return_url"}]},[a("v-btn",{attrs:{text:"",href:t.return_url}},[t._v(t._s(t.return_label))])],1)],1),a("div",{style:"height: "+t.height+"px;"},[a("splitpanes",{staticClass:"default-theme"},[a("pane",{attrs:{"min-size":"20"}},[a("iframe",{staticClass:"py-2 px-2",staticStyle:{border:"none"},attrs:{src:t.mirador_path,seamless:"seamless",width:"100%",height:t.height+"px",allow:"fullscreen"}})]),a("pane",[a("splitpanes",{staticClass:"default-theme",attrs:{horizontal:"horizontal"}},[a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"main"}},[a("v-card-text",{staticClass:"mx-2 text--primary"},[a("h2",{staticClass:"text--primary"},[t._v(t._s(t.label_main))]),a("br"),t._l(t.data_main_e,(function(e,n){return a("p",{key:n},[e.manifest?a("span",[a("img",{staticClass:"mr-2",staticStyle:{width:"30px"},attrs:{src:"https://iiif.dl.itc.u-tokyo.ac.jp/images/iiif.png"},on:{click:function(a){return t.clickIcon(e.id)}}}),a("br")]):t._e(),t._l(e.words,(function(e,n){return a("span",{key:n,style:-1!=t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseover_main,click:function(a){return t.scroll(e.id)}}},[t._v(t._s(e.value))])}))],2)}))],2)],1)],1),a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"sub"}},[a("v-list-item",[a("v-card-text",{staticClass:"mx-2 text--primary"},[a("h2",{staticClass:"text--primary"},[t._v(t._s(t.label_sub))]),a("br"),t._l(t.data_sub,(function(e,n){return a("p",{key:n},[a("span",{style:-1!=t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseover,click:function(a){return t.scroll(e.id)}}},[t._v(t._s(e.value))])])}))],2)],1)],1)],1)],1)],1)],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_information,callback:function(e){t.dialog_information=e},expression:"dialog_information"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("Information")]),a("v-card-text",{staticClass:"mt-5"},[a("a",{attrs:{target:"_blank",href:this.$route.query.u}},[t._v(t._s(this.$route.query.u))])]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_information=!1}}},[t._v("閉じる")])],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_settings,callback:function(e){t.dialog_settings=e},expression:"dialog_settings"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("Settings")]),a("v-card-text",{staticClass:"mt-5"},[a("v-text-field",{staticClass:"mb-5",attrs:{label:"Mirador表示レイアウト Ex. 1x1, 2x2, ..."},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}}),t._l(t.selected_manifests,(function(e,n){return a("v-switch",{key:n,attrs:{label:e.label},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"obj.selected"}})}))],2),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_settings=!1}}},[t._v("閉じる")])],1)],1)],1)],1)},h=[],_=(a("99af"),a("c975"),a("fb6a"),a("b0c0"),a("a9e3"),a("b64b"),a("ac1f"),a("841c"),a("1276"),a("498a"),a("512e")),p=a("bc3a"),f=a.n(p),v="mirador/",g=a("1c46");function b(t){var e=g.createHash("md5");return e.update(t,"binary").digest("hex")}var y={components:{Splitpanes:_["Splitpanes"],Pane:_["Pane"]},data:function(){return{width:window.innerWidth,height:window.innerHeight,return_url:null,return_label:null,dialog_information:!1,dialog_settings:!1,url_main:"",url_sub:"",test:"",data_main:[],data_sub:[],data_main_e:[],data_sub_e:[],hightlights:[],m_s_id_map:[],s_m_id_map:[],w_l_id_map:{},l_w_id_map:{},image_map:{},label_main:"",label_sub:"",selected_manifests:[],mirador_path:"",direction:"vertical",layout:"2x2"}},mounted:function(){var t=this;window.addEventListener("resize",this.handleResize),null==this.$route.query.u&&"localhost"!=location.hostname&&(location.href="https://github.com/TEI-EAJ/parallel_text_viewer/");var e=this.$route.query.u;f.a.get(e).then((function(e){var a=e.data;t.return_url=a.return_url,t.return_label=a.return_label,t.url_main=a.url_main,t.label_main=a.label_main,t.label_sub=a.label_sub;var n=a.query_main,i=a.query_sub;t.direction=a.direction,a.layout&&(t.layout=a.layout);var r=a.image_map;f.a.get(r).then((function(e){for(var r=[],s=e.data,l=[],o={},c=s["selections"],u=0;u<c.length;u++){var d=c[u],m=d.within,h=m.label,_=m["@id"];o[h]={manifest:_,data:{}},r.push({manifest:_}),t.selected_manifests.push({label:h,selected:!0});for(var p=d.members,f=0;f<p.length;f++){var g=p[f];if(g.line_id){var b=g.line_id;b=t.convert_uri(b),l[b]||l.push(b),o[h].data[b]=g["@id"]}}}t.image_map=o,t.mirador_path=v+"?params="+encodeURIComponent(JSON.stringify(r))+"&annotationState=on&layout="+t.layout,t.exec2map(a.url_map),t.exec2main(a.url_main,l,n),t.exec2sub(a.url_sub,i)}))}))},watch:{$route:function(){this.search()}},methods:{clickIcon:function(t){for(var e=this.selected_manifests,a=[],n=0;n<e.length;n++){var i=e[n];if(i.selected){var r=i.label,s=this.image_map[r].data;if(s[t]){var l=s[t],o=l.split("#xywh="),c=o[0],u=o[1].split(","),d=Number(u[1])-150,m=Number(u[3])+150;l=c+"#xywh="+u[0]+","+d+","+u[2]+","+m,a.push({manifest:this.image_map[r].manifest,canvas:l})}this.mirador_path=v+"?params="+encodeURIComponent(JSON.stringify(a))+"&annotationState=on&layout="+this.layout}}},scroll:function(t){var e=[],a="";if(this.m_s_id_map[this.w_l_id_map[t]]?(e=this.m_s_id_map[this.w_l_id_map[t]],a="sub"):this.l_w_id_map[this.s_m_id_map[t][0]]&&(e=this.l_w_id_map[this.s_m_id_map[t][0]],a="main"),e.length>0){var n=e[0];"vertical"==this.direction?this.$SmoothScroll(document.querySelector("#"+n).getBoundingClientRect().left+document.querySelector("#"+a).scrollLeft-document.querySelector("#"+a).getBoundingClientRect().left-document.querySelector("#"+a).getBoundingClientRect().width/2+document.querySelector("#"+n).getBoundingClientRect().width,.1,null,document.querySelector("#"+a),"x"):this.$SmoothScroll(document.querySelector("#"+n).getBoundingClientRect().top+document.querySelector("#"+a).scrollTop-document.querySelector("#"+a).getBoundingClientRect().top,.1,null,document.querySelector("#"+a),"y")}},mouseover_main:function(t){if(t.target.attributes.length>0&&"id"==t.target.attributes[0].name){var e=t.target.attributes[0].value,a=this.w_l_id_map[e],n=[];if(this.m_s_id_map[a]){var i=this.m_s_id_map[a];n=i;for(var r=0;r<i.length;r++)for(var s=i[r],l=this.s_m_id_map[s],o=0;o<l.length;o++){var c=l[o],u=this.l_w_id_map[c];n=n.concat(u)}}this.hightlights=n}},mouseover:function(t){if(0!=Object.keys(this.w_l_id_map)&&t.target.attributes.length>0&&"id"==t.target.attributes[0].name){var e=t.target.attributes[0].value,a=[e];if(this.s_m_id_map[e])for(var n=this.s_m_id_map[e],i=0;i<n.length;i++){var r=n[i],s=this.l_w_id_map[r];a=a.concat(s)}this.hightlights=a}},handleResize:function(){this.width=window.innerWidth,this.height=window.innerHeight},exec2map:function(t){var e=this;f.a.get(t).then((function(t){var a=t.data;for(var n in a){for(var i=a[n],r=[],s=0;s<i.length;s++){var l=i[s],o=e.convert_uri(l);r.push(o)}a[n]=r}var c={};for(var u in a)for(var d=a[u],m=0;m<d.length;m++){var h=d[m];c[h]||(c[h]=[]),c[h].push(u)}e.m_s_id_map=c,e.s_m_id_map=a;var _={},p={};for(var f in c){var v=f.split("#"),g=v[0],b=v[1].split(":"),y=Number(b[0]),x=Number(b[1]);p[f]=[];for(var w=y;w<x;w++){var S=g+"-"+w;_[S]=f,p[f].push(S)}}e.w_l_id_map=_,e.l_w_id_map=p}))},exec2main:function(t,e,a){var n=this;f.a.get(t,{responseType:"document"}).then((function(t){for(var i=t.data,r=i.querySelectorAll(a),s=[],l=0;l<r.length;l++){var o=r[l],c=o.attributes[0].value;c=n.convert_uri(c);for(var u=o.childNodes,d="",m=[],h=0;h<u.length;h++){var _=u[h],p=_.innerText||_.textContent;d+=p.trim()}for(var f=0;f<d.length;f++){var v=d.slice(f,f+1);m.push({value:v,id:c+"-"+f})}var g={id:c,words:m};(-1!=e.indexOf(c)||-1!=o.attributes[0].value.indexOf("-01"))&&(g["manifest"]=!0),s.push(g),n.data_main_e=s}}))},exec2sub:function(t,e){var a=this;f.a.get(t,{responseType:"document"}).then((function(t){for(var n=t.data,i=n.querySelectorAll(e),r=[],s=0;s<i.length;s++){for(var l=i[s],o=l.attributes[0].value,c=l.childNodes,u="",d=0;d<c.length;d++){var m=c[d],h=m.innerText||m.textContent;u+=h.trim()}var _={id:o,value:u};r.push(_)}a.data_sub=r}))},convert_uri:function(t){var e=t.split("#");return 2!=e.length?"id-"+b(t):"id-"+b(e[0])+"#"+e[1]}},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)}},x=y,w=(a("8fc1"),a("6544")),S=a.n(w),I=a("7496"),k=a("8336"),C=a("b0af"),O=a("99d9"),L=a("a75b"),q=a("169a"),T=a("132d"),V=a("da13"),$=a("2fa4"),j=a("b73d"),R=a("8654"),D=a("71d9"),z=a("2a7f"),E=Object(o["a"])(x,m,h,!1,null,null,null),N=E.exports;S()(E,{VApp:I["a"],VBtn:k["a"],VCard:C["a"],VCardActions:O["a"],VCardText:O["b"],VCardTitle:O["c"],VContent:L["a"],VDialog:q["a"],VIcon:T["a"],VListItem:V["a"],VSpacer:$["a"],VSwitch:j["a"],VTextField:R["a"],VToolbar:D["a"],VToolbarItems:z["a"],VToolbarTitle:z["b"]});var B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-content",[a("v-toolbar",{attrs:{dark:!0,flat:""}},[a("v-toolbar-title",[t._v("Parallel Text Viewer with TEI & IIIF")]),a("v-spacer"),a("v-toolbar-items",[a("v-btn",{attrs:{text:"",to:{name:"index",query:{u:t.$route.query.u}}}},[t._v("現行UIに戻る")])],1),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_settings=!0}}},[a("v-icon",[t._v("mdi-settings")])],1),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_information=!0}}},[a("v-icon",[t._v("mdi-information")])],1),a("v-toolbar-items",{directives:[{name:"show",rawName:"v-show",value:t.return_url,expression:"return_url"}]},[a("v-btn",{attrs:{text:"",href:t.return_url}},[t._v(t._s(t.return_label))])],1)],1),a("div",{style:"height: "+t.height+"px;"},[a("splitpanes",{staticClass:"default-theme"},[a("pane",{attrs:{"min-size":"20"}},[a("iframe",{staticClass:"py-2 px-2",staticStyle:{border:"none"},attrs:{src:t.mirador_path,seamless:"seamless",width:"100%",height:t.height+"px",allow:"fullscreen"}})]),a("pane",[a("splitpanes",{staticClass:"default-theme",attrs:{horizontal:"horizontal"}},[a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"main"}},[a("v-card-text",{staticClass:"mx-2 text--primary"},[a("h2",{staticClass:"text--primary"},[t._v(t._s(t.label_main))]),a("br"),t._l(t.data_main_e,(function(e,n){return a("p",{key:n},[e.manifest?a("span",[a("img",{staticClass:"mr-2",staticStyle:{width:"30px"},attrs:{src:"https://iiif.dl.itc.u-tokyo.ac.jp/images/iiif.png"},on:{click:function(a){return t.clickIcon(e.id)}}}),a("br")]):t._e(),t._l(e.words,(function(e,n){return a("span",{key:n,style:-1!=t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseover_main,click:function(a){return t.scroll(e.id)}}},[t._v(t._s(e.value))])}))],2)}))],2)],1)],1),a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"sub"}},[a("v-list-item",[a("v-card-text",{staticClass:"mx-2 text--primary"},[a("h2",{staticClass:"text--primary"},[t._v(t._s(t.label_sub))]),a("br"),t._l(t.data_sub,(function(e,n){return a("p",{key:n},[a("span",{style:-1!=t.hightlights.indexOf(e.id)?"background-color : yellow;":null,attrs:{id:e.id},on:{mouseover:t.mouseover,click:function(a){return t.scroll(e.id)}}},[t._v(t._s(e.value))])])}))],2)],1)],1)],1)],1)],1)],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_information,callback:function(e){t.dialog_information=e},expression:"dialog_information"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("Information")]),a("v-card-text",{staticClass:"mt-5"},[a("a",{attrs:{target:"_blank",href:this.$route.query.u}},[t._v(t._s(this.$route.query.u))])]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_information=!1}}},[t._v("閉じる")])],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_settings,callback:function(e){t.dialog_settings=e},expression:"dialog_settings"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("Settings")]),a("v-card-text",{staticClass:"mt-5"},[a("v-text-field",{staticClass:"mb-5",attrs:{label:"Mirador表示レイアウト Ex. 1x1, 2x2, ..."},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}}),t._l(t.selected_manifests,(function(e,n){return a("v-switch",{key:n,attrs:{label:e.label},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"obj.selected"}})}))],2),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_settings=!1}}},[t._v("閉じる")])],1)],1)],1)],1)},P=[],A=a("1c46");function J(t){var e=A.createHash("md5");return e.update(t,"binary").digest("hex")}var M={components:{Splitpanes:_["Splitpanes"],Pane:_["Pane"]},data:function(){return{width:window.innerWidth,height:window.innerHeight,return_url:null,return_label:null,dialog_information:!1,dialog_settings:!1,url_main:"",url_sub:"",test:"",data_main:[],data_sub:[],data_main_e:[],data_sub_e:[],hightlights:[],m_s_id_map:[],s_m_id_map:[],w_l_id_map:{},l_w_id_map:{},image_map:{},label_main:"",label_sub:"",selected_manifests:[],mirador_path:"",direction:"vertical",layout:"2x2"}},mounted:function(){var t=this;window.addEventListener("resize",this.handleResize),null==this.$route.query.u&&"localhost"!=location.hostname&&(location.href="https://github.com/TEI-EAJ/parallel_text_viewer/");var e=this.$route.query.u;f.a.get(e).then((function(e){var a=e.data;t.return_url=a.return_url,t.return_label=a.return_label,t.url_main=a.url_main,t.label_main=a.label_main,t.label_sub=a.label_sub;var n=a.query_main,i=a.query_sub;t.direction=a.direction,a.layout&&(t.layout=a.layout);var r=a.image_map;f.a.get(r).then((function(e){for(var r=[],s=e.data,l=[],o={},c=s["selections"],u=0;u<c.length;u++){var d=c[u],m=d.within,h=m.label,_=m["@id"];o[h]={manifest:_,data:{}},r.push({manifest:_}),t.selected_manifests.push({label:h,selected:!0});for(var p=d.members,f=0;f<p.length;f++){var v=p[f];if(v.line_id){var g=v.line_id;g=t.convert_uri(g),l[g]||l.push(g),o[h].data[g]=v["@id"]}}}t.image_map=o;var b={},y=[];b.windows=y;for(var x=0;x<r.length;x++)y.push({manifestId:r[x].manifest});t.mirador_path="https://mirador.cultural.jp/?config="+encodeURIComponent(JSON.stringify(b)),t.exec2map(a.url_map),t.exec2main(a.url_main,l,n),t.exec2sub(a.url_sub,i)}))}))},watch:{$route:function(){this.search()}},methods:{clickIcon:function(t){for(var e=this.selected_manifests,a=[],n=0;n<e.length;n++){var i=e[n];if(i.selected){var r=i.label,s=this.image_map[r].data;s[t]&&a.push({manifest:this.image_map[r].manifest,canvas:s[t]});var l={displayAllAnnotations:!0,window:{sideBarOpenByDefault:!0,defaultSideBarPanel:"annotations"}},o=[];l.windows=o;for(var c=0;c<a.length;c++)o.push({manifestId:a[c].manifest,canvasId:a[c].canvas,view:"single"});this.mirador_path="https://mirador.cultural.jp/?config="+encodeURIComponent(JSON.stringify(l))}}},scroll:function(t){var e=[],a="";if(this.m_s_id_map[this.w_l_id_map[t]]?(e=this.m_s_id_map[this.w_l_id_map[t]],a="sub"):this.l_w_id_map[this.s_m_id_map[t][0]]&&(e=this.l_w_id_map[this.s_m_id_map[t][0]],a="main"),e.length>0){var n=e[0];"vertical"==this.direction?this.$SmoothScroll(document.querySelector("#"+n).getBoundingClientRect().left+document.querySelector("#"+a).scrollLeft-document.querySelector("#"+a).getBoundingClientRect().left-document.querySelector("#"+a).getBoundingClientRect().width/2+document.querySelector("#"+n).getBoundingClientRect().width,.1,null,document.querySelector("#"+a),"x"):this.$SmoothScroll(document.querySelector("#"+n).getBoundingClientRect().top+document.querySelector("#"+a).scrollTop-document.querySelector("#"+a).getBoundingClientRect().top,.1,null,document.querySelector("#"+a),"y")}},mouseover_main:function(t){if(t.target.attributes.length>0&&"id"==t.target.attributes[0].name){var e=t.target.attributes[0].value,a=this.w_l_id_map[e],n=[];if(this.m_s_id_map[a]){var i=this.m_s_id_map[a];n=i;for(var r=0;r<i.length;r++)for(var s=i[r],l=this.s_m_id_map[s],o=0;o<l.length;o++){var c=l[o],u=this.l_w_id_map[c];n=n.concat(u)}}this.hightlights=n}},mouseover:function(t){if(t.target.attributes.length>0&&"id"==t.target.attributes[0].name){var e=t.target.attributes[0].value,a=[e];if(this.s_m_id_map[e])for(var n=this.s_m_id_map[e],i=0;i<n.length;i++){var r=n[i],s=this.l_w_id_map[r];a=a.concat(s)}this.hightlights=a}},handleResize:function(){this.width=window.innerWidth,this.height=window.innerHeight},exec2map:function(t){var e=this;f.a.get(t).then((function(t){var a=t.data;for(var n in a){for(var i=a[n],r=[],s=0;s<i.length;s++){var l=i[s],o=e.convert_uri(l);r.push(o)}a[n]=r}var c={};for(var u in a)for(var d=a[u],m=0;m<d.length;m++){var h=d[m];c[h]||(c[h]=[]),c[h].push(u)}e.m_s_id_map=c,e.s_m_id_map=a;var _={},p={};for(var f in c){var v=f.split("#"),g=v[0],b=v[1].split(":"),y=Number(b[0]),x=Number(b[1]);p[f]=[];for(var w=y;w<x;w++){var S=g+"-"+w;_[S]=f,p[f].push(S)}}e.w_l_id_map=_,e.l_w_id_map=p}))},exec2main:function(t,e,a){var n=this;f.a.get(t,{responseType:"document"}).then((function(t){for(var i=t.data,r=i.querySelectorAll(a),s=[],l=0;l<r.length;l++){var o=r[l],c=o.attributes[0].value;c=n.convert_uri(c);for(var u=o.childNodes,d="",m=[],h=0;h<u.length;h++){var _=u[h],p=_.innerText||_.textContent;d+=p.trim()}for(var f=0;f<d.length;f++){var v=d.slice(f,f+1);m.push({value:v,id:c+"-"+f})}var g={id:c,words:m};(-1!=e.indexOf(c)||-1!=o.attributes[0].value.indexOf("-01"))&&(g["manifest"]=!0),s.push(g),n.data_main_e=s}}))},exec2sub:function(t,e){var a=this;f.a.get(t,{responseType:"document"}).then((function(t){for(var n=t.data,i=n.querySelectorAll(e),r=[],s=0;s<i.length;s++){for(var l=i[s],o=l.attributes[0].value,c=l.childNodes,u="",d=0;d<c.length;d++){var m=c[d],h=m.innerText||m.textContent;u+=h.trim()}var _={id:o,value:u};r.push(_)}a.data_sub=r}))},convert_uri:function(t){var e=t.split("#");return 2!=e.length?"id-"+J(t):"id-"+J(e[0])+"#"+e[1]}},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)}},H=M,F=(a("ae10"),Object(o["a"])(H,B,P,!1,null,null,null)),U=F.exports;S()(F,{VApp:I["a"],VBtn:k["a"],VCard:C["a"],VCardActions:O["a"],VCardText:O["b"],VCardTitle:O["c"],VContent:L["a"],VDialog:q["a"],VIcon:T["a"],VListItem:V["a"],VSpacer:$["a"],VSwitch:j["a"],VTextField:R["a"],VToolbar:D["a"],VToolbarItems:z["a"],VToolbarTitle:z["b"]});var W=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-content",[a("v-toolbar",{attrs:{dark:!0,flat:""}},[a("v-toolbar-title",[t._v("Parallel Text Viewer with TEI & IIIF")]),a("v-spacer"),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_settings=!0}}},[a("v-icon",[t._v("mdi-settings")])],1),a("v-btn",{attrs:{icon:""},on:{click:function(e){e.stopPropagation(),t.dialog_information=!0}}},[a("v-icon",[t._v("mdi-information")])],1),a("v-toolbar-items",{directives:[{name:"show",rawName:"v-show",value:t.return_url,expression:"return_url"}]},[a("v-btn",{attrs:{text:"",href:t.return_url}},[t._v(t._s(t.return_label))])],1),a("v-btn",{attrs:{text:""},on:{click:t.changeLocale}},[t._v(" "+t._s(t.$t("change_locale"))+" ")])],1),a("div",{style:"height: "+t.height+"px;"},[a("splitpanes",{staticClass:"default-theme"},[a("pane",{attrs:{size:t.paneSize}},[a("iframe",{staticClass:"py-2 px-2",staticStyle:{border:"none"},attrs:{src:t.mirador_path,seamless:"seamless",width:"100%",height:t.height+"px",allow:"fullscreen"}})]),a("pane",{attrs:{size:100-t.paneSize}},[a("splitpanes",{staticClass:"default-theme",attrs:{horizontal:"horizontal"}},[a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"main"}},[t.data_main?a("Hello",{attrs:{elements:t.data_main.elements}}):t._e()],1)],1),a("pane",{staticClass:"py-2 mx-2"},[a("v-card",{staticClass:"scroll vertical",attrs:{flat:!0,id:"sub"}},[t.data_sub?a("Hello",{attrs:{elements:t.data_sub.elements}}):t._e()],1)],1)],1)],1)],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_information,callback:function(e){t.dialog_information=e},expression:"dialog_information"}},[a("v-card",[a("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[t._v(t._s(t.$t("information")))]),a("v-card-text",{staticClass:"mt-5"},[a("a",{attrs:{target:"_blank",href:this.$route.query.u}},[t._v(t._s(this.$route.query.u))])]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_information=!1}}},[t._v(t._s(t.$t("close")))])],1)],1)],1),a("v-dialog",{attrs:{width:"600px"},model:{value:t.dialog_settings,callback:function(e){t.dialog_settings=e},expression:"dialog_settings"}},[a("v-card",[a("v-card-title",{staticClass:"headline grey lighten-2",attrs:{"primary-title":""}},[t._v(t._s(t.$t("settings")))]),a("v-card-text",{staticClass:"mt-5"},[a("v-text-field",{staticClass:"mb-5",attrs:{label:"Mirador表示レイアウト Ex. 1x1, 2x2, ..."},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}}),t._l(t.selected_manifests,(function(e,n){return a("v-switch",{key:n,attrs:{label:e.label},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"obj.selected"}})}))],2),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{color:"secondary"},on:{click:function(e){t.dialog_settings=!1}}},[t._v(t._s(t.$t("close")))])],1)],1)],1)],1)},X=[],Y=(a("96cf"),a("1da1")),G=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",[t._l(t.elements,(function(e,n){return[e.text?[a("span",{key:n},[t._v(t._s(e.text))])]:"p"==e.name||"head"==e.name||"ab"==e.name||"list"==e.name||"listPerson"==e.name||"item"==e.name||"person"==e.name?[a("span",{key:n,staticClass:"my-5",class:"tei-"+e.name},[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]:"date"==e.name?[a("v-tooltip",{key:n,attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var r=i.on;return[a("span",t._g({style:t.style(e.name)},r),[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]}}],null,!0)},[a("span",[t._v(t._s(e.attributes))])])]:"teiHeader"==e.name?[a("v-sheet",{key:n,staticClass:"pa-5 ma-5",attrs:{color:"grey lighten-3"}},[a("small",[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)])]:"title"==e.name?[a("h2",{key:n,staticClass:"my-5"},[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]:"eaj:ruby"==e.name||e.attributes&&"ruby"==e.attributes.type?[a("ruby",{key:n},[a("Hello",{attrs:{elements:e.elements[0].elements}}),a("rt",[t._v(t._s(e.elements[2].elements[0].text))])],1)]:"persName"==e.name||"placeName"==e.name||"name"==e.name||"rs"==e.name||"speaker"==e.name||"bibl"==e.name?[a("v-tooltip",{key:n,attrs:{bottom:""},scopedSlots:t._u([{key:"activator",fn:function(i){var r=i.on;return[a("span",t._g({key:n,class:"tei-"+e.name,style:"person"!=t.parent&&"respStmt"!=t.parent?t.style(e.name):"margin-right : 10px; margin-left : 10px;",attrs:{id:e.id}},e.attributes?r:null),[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]}}],null,!0)},[a("span",[t._v(t._s(e.attributes))])])]:"seg"==e.name&&e.attributes&&e.attributes.rendition?[a("span",{key:n,class:"tei-"+e.attributes.rendition,style:e.attributes.style},[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]:"anchor"==e.name?[a("span",{key:n,style:t.getAnchorId(e)===t.lineId?"background-color : rgba(255,165,0, 0.5);":"",attrs:{id:"anchor-"+t.getAnchorId(e),dark:""},on:{click:function(a){t.anchorClick(t.getAnchorId(e))},mouseover:function(a){t.mouseover(t.getAnchorId(e))}}},[a("v-icon",{attrs:{small:"",color:"blue darken-2"}},[t._v("mdi-anchor")])],1)]:"seg"==e.name&&e.attributes.corresp?[a("span",{key:n},[a("span",{class:"tei-"+e.name},[e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)])]:"s"==e.name?[a("div"==t.childDiv(e)?"div":"span",{key:n,tag:"component",style:e.attributes["xml:id"]===t.lineId?"background-color : rgba(255,165,0, 0.5);":"",on:{mouseover:function(a){return t.mouseover(e.attributes["xml:id"])},click:function(a){return t.selectSub(e.attributes["xml:id"])}}},[a("span",{class:"tei-"+e.name},[e.elements?a("Hello",{key:n,attrs:{id:"line-"+e.attributes["xml:id"],elements:e.elements,parent:e.name}}):t._e()],1)])]:"figure"!=e.name?[a("span",{key:n,class:"tei-"+e.name},[e.attributes&&e.attributes.facs&&e.attributes.facs.startsWith("#")?a("span",{on:{click:function(a){return t.selectManifest(e)}}},[a("img",{staticClass:"mr-2",staticStyle:{width:"30px"},attrs:{src:"https://iiif.dl.itc.u-tokyo.ac.jp/images/iiif.png"}})]):t._e(),e.elements?a("Hello",{key:n,attrs:{elements:e.elements,parent:e.name}}):t._e()],1)]:t._e()]}))],2)},K=[],Q={name:"Hello",props:["elements","parent"],computed:{lineId:{get:function(){return this.$store.getters.lineId}},subLineId:{get:function(){return this.$store.getters.subLineId}}},methods:{style:function(t){var e="0,0,255";return"persName"==t||"rs"==t?e="0,255,0":"placeName"==t?e="255,0,0":"date"==t?e="255,165,0":"bibl"==t&&(e="128,0,128"),"background-color : rgba("+e+", 0.2);"},mouseover:function(t){this.highlight_line=t,this.$store.dispatch("setLineId",t)},selectSub:function(t){this.$store.dispatch("setSubLineId",t)},editBtnClick:function(t){this.$store.dispatch("setDialogFlag",!0),this.$store.dispatch("setDialogData",t)},anchorClick:function(t){this.$store.dispatch("setMainLineId",t)},childDiv:function(t){return t.elements[0].attributes?"div"==t.elements[0].attributes.rendition?"div":"span":null},getAnchorId:function(t){var e=t.attributes["corresp"].split("#");return 2==e.length?e[1]:1==e.length?e[0]:null},selectManifest:function(t){this.$store.dispatch("setSelectedObj",t)}}},Z=Q,tt=a("8dd9"),et=a("3a2f"),at=Object(o["a"])(Z,G,K,!1,null,null,null),nt=at.exports;S()(at,{VIcon:T["a"],VSheet:tt["a"],VTooltip:et["a"]});var it="mirador/",rt=a("c51a"),st={components:{Splitpanes:_["Splitpanes"],Pane:_["Pane"],Hello:nt},data:function(){return{width:window.innerWidth,height:window.innerHeight,return_url:null,return_label:null,dialog_information:!1,dialog_settings:!1,url_main:"",url_sub:"",data_main:null,data_sub:null,image_map:{},label_main:"",label_sub:"",selected_manifests:[],mirador_path:"",direction:"vertical",layout:"2x2",paneSize:50}},computed:{mainLineId:{get:function(){return this.$store.getters.mainLineId},set:function(t){this.$store.dispatch("setMainLineId",t)}},subLineId:{get:function(){return this.$store.getters.subLineId},set:function(t){this.$store.dispatch("setSubLineId",t)}},selectedObj:{get:function(){return this.$store.getters.selectedObj},set:function(t){this.$store.dispatch("setSelectedObj",t)}}},mounted:function(){var t=this;window.addEventListener("resize",this.handleResize),null==this.$route.query.u&&"localhost"!=location.hostname&&(location.href="https://github.com/TEI-EAJ/parallel_text_viewer/");var e=this.$route.query.u,a=this;f.a.get(e).then((function(e){var n=e.data;t.return_url=n.returnUrl||n.return_url,t.return_label=n.returnLabel||n.return_label,t.url_main=n.urlMain||n.url_main,t.url_sub=n.urlSub||n.url_sub,t.label_main=n.labelMain||n.label_main,t.label_sub=n.labelSub||n.label_sub,t.direction=n.direction,n.layout&&(t.layout=n.layout);var i=n.imageMap||n.image_map;f.a.get(i).then((function(e){var n=[],i=e.data,r={},s=i["selections"],l=s.length;if(1===l)t.layout="1x1";else{var o=2,c=Math.ceil(l/2);t.layout=o+"x"+c}for(var u=0;u<s.length;u++){var d=s[u],m=d.members;if(0!=m.length){var h=d.within,_=h.label,p=h["@id"];r[_]={manifest:p,data:{}},n.push({manifest:p}),t.selected_manifests.push({label:_,selected:!0});for(var f=0;f<m.length;f++){var v=m[f],g=Number(v.label.split("p.")[1]);r[_].data[g]=v["@id"]}}}t.image_map=r,t.mirador_path=it+"?params="+encodeURIComponent(JSON.stringify(n))+"&annotationState=on&layout="+t.layout,a.exec2main(t.url_main),a.exec2sub(t.url_sub),setTimeout((function(){t.paneSize=49.9}),1e3)}))}))},watch:{$route:function(){this.search()},mainLineId:function(){this.scroll("line-"+this.mainLineId,"sub")},subLineId:function(){this.scroll("anchor-"+this.subLineId,"main")},selectedObj:function(){for(var t=Number(this.selectedObj.attributes.n),e=this.selected_manifests,a=[],n=0;n<e.length;n++){var i=e[n];if(i.selected){var r=i.label,s=this.image_map[r].data;if(s[t]){var l=s[t],o=l.split("#xywh="),c=o[0],u=o[1].split(","),d=Number(u[1])-150,m=Number(u[3])+150;l=c+"#xywh="+u[0]+","+d+","+u[2]+","+m,a.push({manifest:this.image_map[r].manifest,canvas:l})}}}this.mirador_path=it+"?params="+encodeURIComponent(JSON.stringify(a))+"&annotationState=on&layout="+this.layout}},methods:{scroll:function(t,e){document.querySelector("#"+t)&&("vertical"==this.direction?this.$SmoothScroll(document.querySelector("#"+t).getBoundingClientRect().left+document.querySelector("#"+e).scrollLeft-document.querySelector("#"+e).getBoundingClientRect().left-document.querySelector("#"+e).getBoundingClientRect().width/2+document.querySelector("#"+t).getBoundingClientRect().width,.1,null,document.querySelector("#"+e),"x"):this.$SmoothScroll(document.querySelector("#"+t).getBoundingClientRect().top+document.querySelector("#"+e).scrollTop-document.querySelector("#"+e).getBoundingClientRect().top,.1,null,document.querySelector("#"+e),"y"))},handleResize:function(){this.width=window.innerWidth,this.height=window.innerHeight},exec2main:function(t){var e=this;return Object(Y["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,f.a.get(t).then((function(t){var a=t.data;if("string"==typeof a){var n=new DOMParser;a=n.parseFromString(a,"text/xml")}var i=(new XMLSerializer).serializeToString(a),r=rt.xml2json(i,{compact:!1,spaces:4});e.data_main=JSON.parse(r)}));case 2:case"end":return a.stop()}}),a)})))()},exec2sub:function(t){var e=this;return Object(Y["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,f.a.get(t).then((function(t){var a=t.data;if("string"==typeof a){var n=new DOMParser;a=n.parseFromString(a,"text/xml")}var i=(new XMLSerializer).serializeToString(a),r=rt.xml2json(i,{compact:!1,spaces:4});e.data_sub=JSON.parse(r)}));case 2:case"end":return a.stop()}}),a)})))()},changeLocale:function(){this.$emit("change-locale")}},beforeDestroy:function(){window.removeEventListener("resize",this.handleResize)}},lt=st,ot=(a("84af"),Object(o["a"])(lt,W,X,!1,null,null,null)),ct=ot.exports;S()(ot,{VApp:I["a"],VBtn:k["a"],VCard:C["a"],VCardActions:O["a"],VCardText:O["b"],VCardTitle:O["c"],VContent:L["a"],VDialog:q["a"],VIcon:T["a"],VSpacer:$["a"],VSwitch:j["a"],VTextField:R["a"],VToolbar:D["a"],VToolbarItems:z["a"],VToolbarTitle:z["b"]}),n["a"].use(d["a"]);var ut=[{path:"/",name:"index",component:N},{path:"/v2",name:"v2",component:ct},{path:"/test",name:"test",component:U}],dt=new d["a"]({base:"",routes:ut,scrollBehavior:function(){return{x:0,y:0}}}),mt=dt,ht=a("f309");n["a"].use(ht["a"]);var _t=new ht["a"]({}),pt=a("c4e8"),ft=a.n(pt),vt=a("2f62");n["a"].use(vt["a"]);var gt=new vt["a"].Store({debug:!0,state:{message:"初期メッセージ",lineId:null,mainLineId:null,subLineId:null,dialogFlag:!1,dialogData:{},fullJson:{},selectedObj:{}},getters:{message:function(t){return t.message},lineId:function(t){return t.lineId},mainLineId:function(t){return t.mainLineId},subLineId:function(t){return t.subLineId},dialogFlag:function(t){return t.dialogFlag},dialogData:function(t){return t.dialogData},fullJson:function(t){return t.fullJson},selectedObj:function(t){return t.selectedObj}},mutations:{setMessage:function(t,e){t.message=e.message},setLineId:function(t,e){t.lineId=e.lineId},setMainLineId:function(t,e){t.mainLineId=e.mainLineId},setSubLineId:function(t,e){t.subLineId=e.subLineId},setDialogFlag:function(t,e){t.dialogFlag=e.dialogFlag},setDialogData:function(t,e){t.dialogData=e.dialogData},setFullJson:function(t,e){t.fullJson=e.fullJson},setSelectedObj:function(t,e){t.selectedObj=e.selectedObj}},actions:{doUpdate:function(t,e){var a=t.commit;a("setMessage",{payload:e})},setLineId:function(t,e){var a=t.commit;a("setLineId",{lineId:e})},setMainLineId:function(t,e){var a=t.commit;a("setMainLineId",{mainLineId:e})},setSubLineId:function(t,e){var a=t.commit;a("setSubLineId",{subLineId:e})},setDialogFlag:function(t,e){var a=t.commit;a("setDialogFlag",{dialogFlag:e})},setDialogData:function(t,e){var a=t.commit;a("setDialogData",{dialogData:e})},setFullJson:function(t,e){var a=t.commit;a("setFullJson",{fullJson:e})},setSelectedObj:function(t,e){var a=t.commit;a("setSelectedObj",{selectedObj:e})}}}),bt=gt,yt=a("a925"),xt=a("ead5"),wt=a.n(xt);n["a"].use(ft.a),n["a"].use(yt["a"]),n["a"].use(wt.a),n["a"].config.productionTip=!1;var St={en:{title:"TEI Anchor Editor",yes:"Yes",no:"No",add:"Add",update:"Update",close:"Close",import:"Import",export:"Export",change_locale:"日本語",text_helper:"Input Text after where the anchor is inserted.",id_helper:"Input text ID which is inserted.",confirm_text:"There is an ongoing data. Do you use it?",advanced_option:"Advanced Option",json_editor:"JSON Editor",edit_dialog:"Edit Dialog",confirm_dialog:"Confirm Dialog",add_dialog:"Input Dialog",left_window:"Left Window",right_window:"Right Window",divide_err_message:"Error in Input Text.",sample:"Example",information:"Information",settings:"Settings"},ja:{title:"TEI Anchor Editor",yes:"はい",no:"いいえ",add:"追加",update:"更新",close:"閉じる",import:"インポート",export:"エクスポート",change_locale:"English",text_helper:"アンカーの挿入箇所より後のテキスト部分を入力してください。",id_helper:"挿入対象テキストのIDを入力してください。",confirm_text:"編集中のデータがあります。そのデータを読み込みますか？",advanced_option:"高度なオプション",json_editor:"JSONエディタ",edit_dialog:"編集ダイアログ",confirm_dialog:"確認ダイアログ",add_dialog:"登録ダイアログ",left_window:"左ウインドウ",right_window:"右ウインドウ",divide_err_message:"入力されたテキストに誤りがあります。",sample:"サンプル",information:"情報",settings:"設定"}},It=new yt["a"]({locale:"ja",messages:St});new n["a"]({store:bt,router:mt,vuetify:_t,i18n:It,render:function(t){return t(u)}}).$mount("#app")},6:function(t,e){},7:function(t,e){},8:function(t,e){},"84af":function(t,e,a){"use strict";var n=a("bc60"),i=a.n(n);i.a},"8fc1":function(t,e,a){"use strict";var n=a("9272"),i=a.n(n);i.a},9:function(t,e){},9272:function(t,e,a){},ae10:function(t,e,a){"use strict";var n=a("4b67"),i=a.n(n);i.a},bc60:function(t,e,a){}});
//# sourceMappingURL=app.e31c9be2.js.map